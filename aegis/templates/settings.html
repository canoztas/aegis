{% extends "base.html" %}

{% block title %}Settings - Aegis{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4" style="max-width: 1600px;">
  <!-- Page Header -->
  <div class="mb-4 fade-in">
    <h1 class="display-5 fw-bold text-light font-monospace mb-2" style="letter-spacing: 0.1em;">
      <i class="bi bi-gear-fill me-3" style="color: var(--brand-primary);"></i>SETTINGS
    </h1>
    <p class="text-muted font-monospace">Manage API credentials and cloud provider configuration</p>
  </div>

  <!-- Tabs -->
  <div class="card bg-panel border-subtle shadow-sm mb-4">
    <div class="card-header bg-black border-bottom border-subtle p-0">
      <ul class="nav nav-tabs border-0" id="settingsTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active rounded-0 border-0 text-uppercase font-monospace small px-4 py-3"
            id="credentials-tab" data-bs-toggle="tab" data-bs-target="#credentials" type="button" role="tab"
            style="letter-spacing: 0.08em; color: var(--text-muted);">
            <i class="bi bi-key-fill me-2"></i> API CREDENTIALS
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link rounded-0 border-0 text-uppercase font-monospace small px-4 py-3" id="usage-tab"
            data-bs-toggle="tab" data-bs-target="#usage" type="button" role="tab"
            style="letter-spacing: 0.08em; color: var(--text-muted);">
            <i class="bi bi-graph-up me-2"></i> USAGE & COSTS
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link rounded-0 border-0 text-uppercase font-monospace small px-4 py-3" id="budget-tab"
            data-bs-toggle="tab" data-bs-target="#budget" type="button" role="tab"
            style="letter-spacing: 0.08em; color: var(--text-muted);">
            <i class="bi bi-wallet2 me-2"></i> BUDGET
          </button>
        </li>
      </ul>
    </div>

    <div class="card-body p-4">
      <div class="tab-content" id="settingsTabsContent">
        <!-- API Credentials Tab -->
        <div class="tab-pane fade show active" id="credentials" role="tabpanel">
          <div class="row g-4">
            <!-- OpenAI -->
            <div class="col-lg-4">
              <div class="card bg-surface border-subtle h-100">
                <div class="card-body p-4">
                  <div class="d-flex align-items-center mb-3">
                    <div class="provider-icon bg-success bg-opacity-10 rounded p-2 me-3">
                      <i class="bi bi-robot fs-4" style="color: #10b981;"></i>
                    </div>
                    <div>
                      <h5 class="mb-0 font-monospace text-light">OpenAI</h5>
                      <small class="text-muted font-monospace">GPT-4, GPT-3.5</small>
                    </div>
                  </div>

                  <form id="openaiForm" class="credential-form" data-provider="openai">
                    <div class="mb-3">
                      <label class="form-label font-monospace small text-muted">API Key</label>
                      <div class="input-group">
                        <input type="password" class="form-control bg-panel border-subtle text-light font-monospace"
                          id="openaiApiKey" placeholder="sk-...">
                        <button class="btn btn-outline-secondary" type="button"
                          onclick="togglePasswordVisibility('openaiApiKey')">
                          <i class="bi bi-eye"></i>
                        </button>
                      </div>
                    </div>

                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-primary btn-sm font-monospace flex-fill validate-btn"
                        data-provider="openai">
                        <i class="bi bi-check-circle me-1"></i> Validate
                      </button>
                      <button type="submit" class="btn btn-success btn-sm font-monospace flex-fill">
                        <i class="bi bi-save me-1"></i> Save
                      </button>
                    </div>
                  </form>

                  <div class="mt-3 pt-3 border-top border-subtle">
                    <div class="credential-status" id="openai-status">
                      <small class="text-muted font-monospace">Status: <span
                          class="text-warning">Not configured</span></small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Anthropic -->
            <div class="col-lg-4">
              <div class="card bg-surface border-subtle h-100">
                <div class="card-body p-4">
                  <div class="d-flex align-items-center mb-3">
                    <div class="provider-icon bg-primary bg-opacity-10 rounded p-2 me-3">
                      <i class="bi bi-chat-dots fs-4" style="color: var(--brand-primary);"></i>
                    </div>
                    <div>
                      <h5 class="mb-0 font-monospace text-light">Anthropic</h5>
                      <small class="text-muted font-monospace">Claude 3 Family</small>
                    </div>
                  </div>

                  <form id="anthropicForm" class="credential-form" data-provider="anthropic">
                    <div class="mb-3">
                      <label class="form-label font-monospace small text-muted">API Key</label>
                      <div class="input-group">
                        <input type="password" class="form-control bg-panel border-subtle text-light font-monospace"
                          id="anthropicApiKey" placeholder="sk-ant-...">
                        <button class="btn btn-outline-secondary" type="button"
                          onclick="togglePasswordVisibility('anthropicApiKey')">
                          <i class="bi bi-eye"></i>
                        </button>
                      </div>
                    </div>

                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-primary btn-sm font-monospace flex-fill validate-btn"
                        data-provider="anthropic">
                        <i class="bi bi-check-circle me-1"></i> Validate
                      </button>
                      <button type="submit" class="btn btn-success btn-sm font-monospace flex-fill">
                        <i class="bi bi-save me-1"></i> Save
                      </button>
                    </div>
                  </form>

                  <div class="mt-3 pt-3 border-top border-subtle">
                    <div class="credential-status" id="anthropic-status">
                      <small class="text-muted font-monospace">Status: <span
                          class="text-warning">Not configured</span></small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Google -->
            <div class="col-lg-4">
              <div class="card bg-surface border-subtle h-100">
                <div class="card-body p-4">
                  <div class="d-flex align-items-center mb-3">
                    <div class="provider-icon bg-info bg-opacity-10 rounded p-2 me-3">
                      <i class="bi bi-stars fs-4" style="color: #06b6d4;"></i>
                    </div>
                    <div>
                      <h5 class="mb-0 font-monospace text-light">Google</h5>
                      <small class="text-muted font-monospace">Gemini Pro, Flash</small>
                    </div>
                  </div>

                  <form id="googleForm" class="credential-form" data-provider="google">
                    <div class="mb-3">
                      <label class="form-label font-monospace small text-muted">API Key</label>
                      <div class="input-group">
                        <input type="password" class="form-control bg-panel border-subtle text-light font-monospace"
                          id="googleApiKey" placeholder="AI...">
                        <button class="btn btn-outline-secondary" type="button"
                          onclick="togglePasswordVisibility('googleApiKey')">
                          <i class="bi bi-eye"></i>
                        </button>
                      </div>
                    </div>

                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-primary btn-sm font-monospace flex-fill validate-btn"
                        data-provider="google">
                        <i class="bi bi-check-circle me-1"></i> Validate
                      </button>
                      <button type="submit" class="btn btn-success btn-sm font-monospace flex-fill">
                        <i class="bi bi-save me-1"></i> Save
                      </button>
                    </div>
                  </form>

                  <div class="mt-3 pt-3 border-top border-subtle">
                    <div class="credential-status" id="google-status">
                      <small class="text-muted font-monospace">Status: <span
                          class="text-warning">Not configured</span></small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Info Box -->
          <div class="alert alert-info bg-panel border-primary mt-4 font-monospace small" role="alert"
            style="border-left-width: 4px;">
            <i class="bi bi-info-circle-fill me-2"></i>
            <strong>Security:</strong> All API keys are encrypted before storage. Keys are never exposed in logs or UI
            after saving.
          </div>
        </div>

        <!-- Usage & Costs Tab -->
        <div class="tab-pane fade" id="usage" role="tabpanel">
          <div class="row g-4 mb-4">
            <!-- Total Cost Card -->
            <div class="col-md-4">
              <div class="card bg-surface border-subtle">
                <div class="card-body text-center p-4">
                  <i class="bi bi-cash-coin fs-1 text-success mb-3"></i>
                  <h2 class="display-6 fw-bold text-light font-monospace mb-1" id="totalCost">$0.00</h2>
                  <p class="text-muted small font-monospace mb-0">Total API Cost (30d)</p>
                </div>
              </div>
            </div>

            <!-- Total Requests Card -->
            <div class="col-md-4">
              <div class="card bg-surface border-subtle">
                <div class="card-body text-center p-4">
                  <i class="bi bi-send fs-1 text-primary mb-3"></i>
                  <h2 class="display-6 fw-bold text-light font-monospace mb-1" id="totalRequests">0</h2>
                  <p class="text-muted small font-monospace mb-0">API Requests (30d)</p>
                </div>
              </div>
            </div>

            <!-- Total Tokens Card -->
            <div class="col-md-4">
              <div class="card bg-surface border-subtle">
                <div class="card-body text-center p-4">
                  <i class="bi bi-cpu fs-1 text-info mb-3"></i>
                  <h2 class="display-6 fw-bold text-light font-monospace mb-1" id="totalTokens">0</h2>
                  <p class="text-muted small font-monospace mb-0">Total Tokens (30d)</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Usage by Provider Table -->
          <div class="card bg-surface border-subtle">
            <div class="card-header bg-black border-bottom border-subtle py-3">
              <h6 class="mb-0 text-uppercase font-monospace text-light" style="letter-spacing: 0.1em;">
                <i class="bi bi-table me-2"></i> Usage by Provider
              </h6>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-dark table-hover mb-0 font-monospace">
                  <thead>
                    <tr class="text-muted small">
                      <th class="border-0 py-3 ps-4">Provider</th>
                      <th class="border-0 py-3">Model</th>
                      <th class="border-0 py-3 text-end">Requests</th>
                      <th class="border-0 py-3 text-end">Tokens</th>
                      <th class="border-0 py-3 text-end pe-4">Cost (USD)</th>
                    </tr>
                  </thead>
                  <tbody id="usageTableBody">
                    <tr>
                      <td colspan="5" class="text-center text-muted py-4">
                        <i class="bi bi-hourglass-split me-2"></i>Loading usage data...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Budget Tab -->
        <div class="tab-pane fade" id="budget" role="tabpanel">
          <div class="row">
            <div class="col-lg-6 mx-auto">
              <div class="card bg-surface border-subtle">
                <div class="card-body p-4">
                  <h5 class="font-monospace text-light mb-4">
                    <i class="bi bi-wallet2 me-2 text-warning"></i>Budget Configuration
                  </h5>

                  <form id="budgetForm">
                    <div class="mb-4">
                      <label class="form-label font-monospace small text-muted">Monthly Budget (USD)</label>
                      <div class="input-group">
                        <span class="input-group-text bg-panel border-subtle text-muted">$</span>
                        <input type="number" class="form-control bg-panel border-subtle text-light font-monospace"
                          id="budgetAmount" placeholder="100.00" step="0.01" min="0">
                      </div>
                    </div>

                    <div class="mb-4">
                      <label class="form-label font-monospace small text-muted">Alert Threshold (%)</label>
                      <input type="range" class="form-range" id="alertThreshold" min="50" max="100" value="80" step="5">
                      <div class="d-flex justify-content-between">
                        <small class="text-muted font-monospace">50%</small>
                        <small class="text-primary font-monospace fw-bold" id="thresholdValue">80%</small>
                        <small class="text-muted font-monospace">100%</small>
                      </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 font-monospace">
                      <i class="bi bi-save me-2"></i>Save Budget Configuration
                    </button>
                  </form>

                  <!-- Budget Status -->
                  <div class="mt-4 pt-4 border-top border-subtle" id="budgetStatus" style="display: none;">
                    <div class="d-flex justify-content-between mb-2">
                      <span class="font-monospace small text-muted">Current Usage</span>
                      <span class="font-monospace small text-light fw-bold" id="currentUsage">$0.00</span>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                      <div class="progress-bar bg-primary" id="budgetProgress" role="progressbar" style="width: 0%">
                      </div>
                    </div>
                    <small class="text-muted font-monospace" id="budgetMessage">Budget tracking active</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}
